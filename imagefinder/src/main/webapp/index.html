<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Crawler</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input[type="text"] {
      width: 400px;
      padding: 8px;
      font-size: 16px;
    }
    button {
      padding: 8px 16px;
      font-size: 16px;
      margin-left: 10px;
      cursor: pointer;
    }
    #results {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .image-container {
      width: 120px;
      text-align: center;
    }
    .image-container img {
      height: 120px;
      width: 120px;
      object-fit: contain;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .image-container p {
      font-size: 10px;
      word-break: break-all;
      margin-top: 4px;
    }
  </style>
</head>
<body>

<h1>Image Crawler</h1>
<div>
  <input type="text" name="url" placeholder="Enter website URL" value="https://www.walmart.com/">
  <button id="submit">Submit</button>
</div>

<div id="results"></div>

<script>
  const input = document.querySelector('input[name="url"]');
  const button = document.getElementById('submit');
  const results = document.getElementById('results');

  button.addEventListener('click', function (e) {
    e.preventDefault();
    results.innerHTML = '⏳ Crawling...';
    const urlValue = input.value.trim();
    if (!urlValue) return;

    results.innerHTML = '';

    const eventSource = new EventSource(`/stream?url=${encodeURIComponent(urlValue)}`);

    eventSource.onmessage = function (event) {
      try {
        const imgObj = JSON.parse(event.data);
        const container = document.createElement('div');
        container.className = 'image-container';

        const img = document.createElement('img');
        img.src = imgObj.url;
        img.alt = "Crawled image";

        const label = document.createElement('p');
        label.textContent = imgObj.xpath;

        container.appendChild(img);
        container.appendChild(label);
        results.appendChild(container);
      } catch (e) {
        console.error("⚠️ Error parsing streamed image:", e);
      }
    };

    eventSource.onerror = function () {
      console.log("❌ Streaming finished or error occurred.");
      eventSource.close();
    };
  });
</script>


</body>
</html>
